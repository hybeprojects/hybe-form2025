(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))f(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&f(c)}).observe(document,{childList:!0,subtree:!0});function l(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function f(o){if(o.ep)return;o.ep=!0;const a=l(o);fetch(o.href,a)}})();if(typeof document<"u"){let l=function(f,o="warning",a=4e3){const c=document.getElementById("global-toast");if(c){c.className=`toast align-items-center text-white bg-${o} border-0`,document.getElementById("global-toast-body").textContent=f;const E=new bootstrap.Toast(c);E.show(),a>0&&setTimeout(()=>E.hide(),a)}};var he=l;class J{constructor(){this.activeModals=new Map,this.activeTimers=new Map}initialize(o){const a=document.getElementById(o);if(!a)return l(`Modal ${o} not found`,"danger"),null;try{const c=new bootstrap.Modal(a,{backdrop:"static",keyboard:!1});return this.activeModals.set(o,c),a.addEventListener("hidden.bs.modal",()=>this.cleanup(o),{once:!0}),c}catch(c){return l(`Failed to initialize modal "${o}": ${c.message}`,"danger"),null}}show(o,a={}){const c=this.activeModals.get(o)||this.initialize(o);c&&(a.countdown&&this.setupCountdown(o,a.countdown),c.show(),(o==="validationModal"||o==="paymentModal")&&this.setupSpinnerTimeout(o))}hide(o){const a=this.activeModals.get(o);a&&a.hide()}setupCountdown(o,{duration:a,elementId:c,onComplete:E}){const p=document.getElementById(c);if(!p){l(`Countdown element "${c}" not found`,"danger");return}let b=a;p.textContent=b,p.setAttribute("aria-live","assertive");const M=setInterval(()=>{if(b--,p.textContent=b,b<=0&&(this.cleanup(o),this.hide(o),typeof E=="function"))try{E()}catch(S){l(`Error in onComplete callback: ${S.message}`,"danger")}},1e3);this.activeTimers.set(o,M)}setupSpinnerTimeout(o,a=15e3){setTimeout(()=>{const c=this.activeModals.get(o);c&&c._element.classList.contains("show")&&(l("This is taking longer than expected. Please check your connection.","danger"),this.hide(o))},a)}cleanup(o){const a=this.activeTimers.get(o);a&&(clearInterval(a),this.activeTimers.delete(o))}}const m=new J;document.addEventListener("DOMContentLoaded",()=>{typeof AOS<"u"&&AOS.init({duration:800,once:!0}),document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(e=>{new bootstrap.Tooltip(e)});const f=document.getElementById("subscription-form"),o=document.getElementById("submit-btn"),a=o==null?void 0:o.querySelector(".btn-text"),c=o==null?void 0:o.querySelector(".spinner-border"),E=document.querySelector(".progress-bar"),p=document.getElementById("country-select"),b=document.getElementById("country"),M=document.getElementById("phone-prefix"),S=document.getElementById("phone"),x=document.getElementById("payment-type"),V=document.getElementById("installment-options"),I=document.getElementById("installment-terms"),P=document.getElementById("branch"),q=document.getElementById("group"),k=document.getElementById("artist"),C=document.createElement("div");C.id="form-debug-msg",C.style.color="red",C.style.fontSize="0.95em",C.style.marginTop="0.5em",o&&o.parentNode.insertBefore(C,o.nextSibling);const G=[{name:"BigHit Music",groups:["BTS","TXT"]},{name:"PLEDIS Entertainment",groups:["SEVENTEEN","fromis_9"]},{name:"BELIFT LAB",groups:["ENHYPEN","ILLIT"]},{name:"KOZ Entertainment",groups:["ZICO"]},{name:"ADOR",groups:["NewJeans"]},{name:"HYBE Labels Japan",groups:["&TEAM"]}],K={BTS:["RM","Jin","SUGA","j-hope","Jimin","V","Jung Kook"],TXT:["SOOBIN","YEONJUN","BEOMGYU","TAEHYUN","HUENINGKAI"],SEVENTEEN:["S.COUPS","JEONGHAN","JOSHUA","JUN","HOSHI","WONWOO","WOOZI","THE 8","MINGYU","DK","SEUNGKWAN","VERNON","DINO"],fromis_9:["LEE SAEROM","SONG HAYOUNG","PARK JIWON","ROH JISUN","LEE SEOYEON","LEE CHAEYOUNG","LEE NAGYUNG","BAEK JIHEON"],ENHYPEN:["JUNGWON","HEESEUNG","JAY","JAKE","SUNGHOON","SUNOO","NI-KI"],ILLIT:["YUNAH","MINJU","MOKA","WONHEE","IROHA"],ZICO:["ZICO"],NewJeans:["MINJI","HANNI","DANIELLE","HAERIN","HYEIN"],"&TEAM":["K","FUMA","NICHOLAS","EJ","YUMA","JO","HARUA","TAKI","MAKI"]},ie={US:{flag:"ðŸ‡ºðŸ‡¸",code:"+1",format:"(XXX) XXX-XXXX"},GB:{flag:"ðŸ‡¬ðŸ‡§",code:"+44",format:"XXXX XXXXXX"},JP:{flag:"ðŸ‡¯ðŸ‡µ",code:"+81",format:"XX-XXXX-XXXX"},KR:{flag:"ðŸ‡°ðŸ‡·",code:"+82",format:"XX-XXXX-XXXX"},CN:{flag:"ðŸ‡¨ðŸ‡³",code:"+86",format:"XXX XXXX XXXX"},FR:{flag:"ðŸ‡«ðŸ‡·",code:"+33",format:"X XX XX XX XX"},DE:{flag:"ðŸ‡©ðŸ‡ª",code:"+49",format:"XXXX XXXXXXX"},IN:{flag:"ðŸ‡®ðŸ‡³",code:"+91",format:"XXXXX-XXXXX"},BR:{flag:"ðŸ‡§ðŸ‡·",code:"+55",format:"(XX) XXXXX-XXXX"},CA:{flag:"ðŸ‡¨ðŸ‡¦",code:"+1",format:"(XXX) XXX-XXXX"},NG:{flag:"ðŸ‡³ðŸ‡¬",code:"+234",format:"XXX XXX XXXX"}},L={"referral-code":{required:!0,message:"Referral code is required."},"full-name":{required:!0,message:"Please enter your full name."},email:{required:!0,pattern:/^[^@\s]+@[^@\s]+\.[^@\s]+$/,message:"Please enter a valid email address."},phone:{required:!0,pattern:/^\+?[\d\s\-()]{7,20}$/,message:"Please enter a valid phone number."},"address-line1":{required:!0,message:"Street address is required."},city:{required:!0,message:"City is required."},"postal-code":{required:!0,pattern:/^.{2,10}$/,message:"Postal code is required."},"country-select":{required:!0,message:"Please select your country."},dob:{required:!0,message:"Date of birth is required."},gender:{required:!0,message:"Please select your gender."},branch:{required:!0,message:"Please select a branch."},group:{required:!0,message:"Please select a group."},artist:{required:!0,message:"Please select an artist."},"payment-type":{required:!0,message:"Please select a payment type."},"contact-method":{required:!0,message:"Please select a contact method."},"subscription-agreement":{required:!0,message:"You must agree to complete your subscription."},"installment-plan":{required:!1,message:"Please select an installment plan."},"installment-terms":{required:!1,message:"You must agree to the installment terms."}};function B(e,t={}){return fetch(e,t).then(n=>{if(!n.ok)throw new Error(`Network error: ${n.status}`);return n}).catch(n=>{throw l(`Network error: ${n.message}`,"danger"),n})}async function Y(e){try{return await e.clone().json()||{}}catch{try{const t=await e.text();return t?JSON.parse(t):{}}catch{return{}}}}function Z(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function j(e,t){let n=e.parentElement.querySelector(".invalid-feedback");n||(n=document.createElement("div"),n.className="invalid-feedback",e.parentElement.appendChild(n)),n.textContent=t,e.classList.add("is-invalid"),e.setAttribute("aria-invalid","true")}function re(e){const t=e.parentElement.querySelector(".invalid-feedback");t&&(t.textContent=""),e.classList.remove("is-invalid"),e.setAttribute("aria-invalid","false")}function N(e){const t=L[e.name||e.id];return t?t.required&&!e.value||t.pattern&&e.value&&!t.pattern.test(e.value)?(j(e,t.message),!1):(re(e),!0):!0}function H(e){e&&(e.classList.remove("shake"),e.offsetWidth,e.classList.add("shake"),e.addEventListener("animationend",()=>e.classList.remove("shake"),{once:!0}))}function v(){const e=f.querySelectorAll("[required]");let t=0;e.forEach(i=>{(i.value.trim()||i.type==="radio"&&i.checked)&&t++});const n=t/e.length*100;E.style.width=`${n}%`,E.setAttribute("aria-valuenow",n)}function ae(e=!1){const t=f.querySelectorAll("[required]"),n=[];let i=!0;return t.forEach(r=>{N(r)||(i=!1,e&&n.push(r.name||r.id))}),e?n:i}G.forEach(e=>{const t=document.createElement("option");t.value=e.name,t.textContent=e.name,P.appendChild(t)}),P.addEventListener("change",()=>{q.innerHTML='<option value="" disabled selected>Select a Group</option>',k.innerHTML='<option value="" disabled selected>Select an Artist</option>';const e=G.find(t=>t.name===P.value);e&&e.groups.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,q.appendChild(n)}),v()}),q.addEventListener("change",()=>{k.innerHTML='<option value="" disabled selected>Select an Artist</option>';const e=q.value;K[e]&&K[e].forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,k.appendChild(n)}),v()});async function se(){var t;p.innerHTML='<option value="" disabled selected>Select Country</option>';let e=[];try{e=(await(await B("https://restcountries.com/v3.1/all?fields=name,cca2")).json()).map(i=>({code:i.cca2,name:i.name.common}))}catch{e=[{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"},{code:"JP",name:"Japan"},{code:"KR",name:"South Korea"},{code:"CN",name:"China"},{code:"FR",name:"France"},{code:"DE",name:"Germany"},{code:"IN",name:"India"},{code:"BR",name:"Brazil"},{code:"CA",name:"Canada"},{code:"NG",name:"Nigeria"}],l("Could not load full country list. Using fallback.","warning")}e.sort((n,i)=>n.name.localeCompare(i.name)),e.forEach(n=>{const i=document.createElement("option");i.value=n.code,i.textContent=n.name,p.appendChild(i)});try{const r=(t=(await(await B("https://ipwho.is/")).json()).country_code)==null?void 0:t.toUpperCase();r&&(p.value=r,b.value=r,W(r))}catch{l("Could not auto-detect country. Please select manually.","warning")}}function W(e){const t=ie[e]||{flag:"ðŸŒ",code:""};M.textContent=`${t.flag} ${t.code}`,S.value="",S.oninput=()=>{let n=S.value.replace(/\D/g,""),i=n;e==="US"||e==="CA"?n.length>3&&n.length<=6?i=`(${n.slice(0,3)}) ${n.slice(3)}`:n.length>6&&(i=`(${n.slice(0,3)}) ${n.slice(3,6)}-${n.slice(6,10)}`):e==="GB"?n.length>4&&(i=`${n.slice(0,4)} ${n.slice(4,10)}`):e==="NG"&&n.length>3&&(i=`${n.slice(0,3)} ${n.slice(3,6)} ${n.slice(6,10)}`),S.value=i}}function le(e){const t={US:{fields:[{id:"address-line1",label:"Street Address",placeholder:"123 Main St",required:!0},{id:"address-line2",label:"Apt/Suite (optional)",placeholder:"Apt, suite, etc.",required:!1},{id:"city",label:"City",placeholder:"City",required:!0},{id:"state",label:"State",placeholder:"State",required:!0},{id:"postal-code",label:"ZIP Code",placeholder:"12345",required:!0,pattern:/^\d{5}(-\d{4})?$/,error:"Invalid ZIP code"}],order:["address-line1","address-line2","city","state","postal-code"]},JP:{fields:[{id:"postal-code",label:"Postal Code",placeholder:"100-0001",required:!0,pattern:/^\d{3}-\d{4}$/,error:"Invalid postal code"},{id:"address-line1",label:"Prefecture",placeholder:"Tokyo",required:!0},{id:"address-line2",label:"City/Ward",placeholder:"Chiyoda-ku",required:!0},{id:"city",label:"Town/Block",placeholder:"Kanda",required:!0},{id:"state",label:"Building/Apartment (optional)",placeholder:"Building, room, etc.",required:!1}],order:["postal-code","address-line1","address-line2","city","state"]},default:{fields:[{id:"address-line1",label:"Address Line 1",placeholder:"Address Line 1",required:!0},{id:"address-line2",label:"Address Line 2 (optional)",placeholder:"Address Line 2",required:!1},{id:"city",label:"City/Town",placeholder:"City/Town",required:!0},{id:"state",label:"State/Province/Region",placeholder:"State/Province/Region",required:!1},{id:"postal-code",label:"Postal Code",placeholder:"Postal Code",required:!0,pattern:/^.{2,10}$/,error:"Invalid postal code"}],order:["address-line1","address-line2","city","state","postal-code"]}},n=t[e]||t.default;n.fields.forEach(r=>{const s=document.getElementById(r.id);if(s){s.placeholder=r.placeholder;const u=s.previousElementSibling;u&&u.classList.contains("form-label")&&(u.textContent=r.label),s.required=r.required,s.pattern=r.pattern?r.pattern.source:"",L[r.id].pattern=r.pattern,L[r.id].message=r.error||L[r.id].message,s.parentElement.style.display=""}}),["address-line1","address-line2","city","state","postal-code"].forEach(r=>{if(!n.order.includes(r)){const s=document.getElementById(r);s&&(s.parentElement.style.display="none")}});const i=document.getElementById("address-fields");n.order.forEach(r=>{const s=document.getElementById(r);s&&i&&i.appendChild(s.parentElement)})}function _(){x.value==="Installment"?(V.classList.remove("d-none"),document.getElementById("installment-plan").required=!0,I&&(I.closest(".form-check").classList.remove("d-none"),I.required=!0,L["installment-terms"].required=!0)):(V.classList.add("d-none"),document.getElementById("installment-plan").required=!1,I&&(I.closest(".form-check").classList.add("d-none"),I.checked=!1,I.required=!1,L["installment-terms"].required=!1)),v()}x.addEventListener("change",_),p.addEventListener("change",()=>{b.value=p.value,W(p.value),le(p.value),v()}),f.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("input",()=>{N(e),v()}),e.addEventListener("blur",()=>N(e)),e.addEventListener("invalid",()=>H(e))}),document.getElementById("digital-currency-home-btn").addEventListener("click",()=>{m.hide("digitalCurrencySuccessModal"),m.show("loadingRedirectModal",{countdown:{duration:5,elementId:"redirect-countdown",onComplete:()=>window.location.href="https://hybecorp.com"}})});function ce(){const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";let t="";for(let n=0;n<10;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return`HYB${t}`}function de(e){const t=new FormData(e),n=ce();document.getElementById("submission-id").value=n,document.getElementById("permit-id").value=n,t.set("submission-id",n),t.set("permit-id",n);const i=new Date().toISOString();t.set("submission-timestamp",i);const r=document.querySelector('input[name="payment-method"]:checked');r&&t.set("payment-method",r.value);const s=document.querySelector('input[name="contact-method"]:checked');return s&&t.set("contact-method",s.value),t.set("language",document.getElementById("language-switcher").value),t.set("country",document.getElementById("country-select").value),t.set("currency",document.getElementById("currency").value||"USD"),t.set("user-agent",navigator.userAgent),t.set("screen-resolution",`${screen.width}x${screen.height}`),t.set("referrer",document.referrer||"Direct"),{formData:t,uniqueID:n,submissionTime:i}}f.addEventListener("submit",async e=>{var n;if(e.preventDefault(),!d.isVerified){l("Please verify your email address before submitting the form.","warning"),g.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{g.focus(),H(g)},500);return}if(!ae()){l("Please correct the highlighted errors and try again.","danger"),f.querySelectorAll("[required]").forEach(i=>{N(i)||H(i)});return}o.disabled=!0,c.classList.remove("d-none"),a.textContent="Submitting...";const t=(n=document.querySelector('input[name="payment-method"]:checked'))==null?void 0:n.value;try{const{formData:i,uniqueID:r,submissionTime:s}=de(f);i.set("email-verification-status","verified"),i.set("email-verification-timestamp",new Date().toISOString()),i.set("verification-token",d.verificationToken),console.log("Generated Subscription ID:",r),console.log("Submission Time:",s),console.log("Email Verification Status:","verified");try{await B("/",{method:"POST",body:i}),console.log("Netlify form submission successful with ID:",r)}catch(u){console.warn("Netlify form submission skipped (dev/local):",u.message)}l("Form submitted successfully! You will receive a confirmation email shortly.","success");try{const u={};for(const[ge,ye]of i.entries())u[ge]=ye;const pe=await(await B("/submit-fan-permit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).json();console.log("Netlify Function response for ID",r,":",pe)}catch(u){console.warn("Netlify Function submission failed for ID",r,":",u.message)}t==="Card Payment"?m.show("validationModal",{countdown:{duration:5,elementId:"countdown",onComplete:()=>{m.show("paymentModal",{countdown:{duration:5,elementId:"payment-countdown",onComplete:()=>{const u=x.value==="Installment"?"https://buy.stripe.com/3cIfZhgGxdPlaOBaNL2ZO06":"https://buy.stripe.com/14AfZh1LD4eL9Kx0972ZO04";m.show("loadingRedirectModal",{countdown:{duration:5,elementId:"redirect-countdown",onComplete:()=>window.location.href=u}})}}})}}}):m.show("validationModal",{countdown:{duration:5,elementId:"countdown",onComplete:()=>{m.show("digitalCurrencySuccessModal",{countdown:{duration:5,elementId:"digital-currency-countdown",onComplete:()=>{m.show("loadingRedirectModal",{countdown:{duration:5,elementId:"redirect-countdown",onComplete:()=>window.location.href="https://hybecorp.com"}})}}})}}})}catch(i){console.error("Submission Error:",i.message,i.stack),l(`Submission failed: ${i.message}. Please try again.`,"danger"),o.disabled=!1,c.classList.add("d-none"),a.textContent="Submit Subscription"}});async function ue(){try{const t=await(await B("https://ipwho.is/")).json();t.city&&(document.getElementById("city").value=t.city),t.region&&(document.getElementById("state").value=t.region),t.postal&&(document.getElementById("postal-code").value=t.postal),v()}catch{l("Could not auto-fill address.","warning")}}m.show("onboardingModal"),se(),ue(),_(),v();let d={isVerified:!1,currentEmail:"",verificationToken:"",otpSent:!1,resendTimer:0};const g=document.getElementById("email"),h=document.getElementById("verify-email-btn"),D=new bootstrap.Modal(document.getElementById("emailVerificationModal"),{backdrop:"static",keyboard:!1}),z=document.getElementById("verification-email"),T=document.getElementById("send-otp-btn"),w=document.getElementById("verify-otp-btn"),U=document.getElementById("resend-otp-btn"),y=document.getElementById("otp-input"),Q=document.getElementById("email-unverified"),ee=document.getElementById("email-verified-badge"),te=document.getElementById("submit-email-icon"),A=document.getElementById("submit-help-text");function $(){d.isVerified?(Q.classList.add("d-none"),ee.classList.remove("d-none"),h.innerHTML='<i class="bi bi-check-circle-fill text-success"></i> Verified',h.classList.remove("btn-outline-primary"),h.classList.add("btn-outline-success"),h.disabled=!0,o.disabled=!1,te.className="bi bi-send me-2",o.querySelector(".btn-text").innerHTML='<i class="bi bi-send me-2"></i>Submit Subscription',A.innerHTML='<i class="bi bi-check-circle-fill text-success me-1"></i>Ready to submit your subscription',A.className="text-success",document.getElementById("email-verified").value="true",document.getElementById("verification-token").value=d.verificationToken):(Q.classList.remove("d-none"),ee.classList.add("d-none"),h.innerHTML='<i class="bi bi-envelope-check"></i> Verify',h.classList.add("btn-outline-primary"),h.classList.remove("btn-outline-success"),h.disabled=!1,o.disabled=!0,te.className="bi bi-envelope-exclamation me-2",o.querySelector(".btn-text").innerHTML='<i class="bi bi-envelope-exclamation me-2"></i>Verify Email to Continue',A.innerHTML='<i class="bi bi-info-circle me-1"></i>Please verify your email address before submitting the form',A.className="text-muted",document.getElementById("email-verified").value="false",document.getElementById("verification-token").value="")}function me(){g.value.trim()!==d.currentEmail&&d.isVerified&&(d.isVerified=!1,d.currentEmail="",d.verificationToken="",$(),l("Email changed. Please verify your new email address.","warning"))}g.addEventListener("input",()=>{me(),N(g),v()}),h.addEventListener("click",()=>{const e=g.value.trim();if(!e||!N(g)){l("Please enter a valid email address first.","warning"),g.focus();return}z.value=e,d.currentEmail=e,O(1),D.show()});function O(e){document.querySelectorAll(".verification-step").forEach(t=>t.classList.add("d-none")),document.getElementById(`verification-step-${e}`).classList.remove("d-none"),e===2&&(document.getElementById("sent-to-email").textContent=d.currentEmail,y.focus())}T.addEventListener("click",async()=>{const e=z.value.trim();if(!e)return;const t=T.querySelector(".btn-text"),n=T.querySelector(".spinner-border");T.disabled=!0,n.classList.remove("d-none"),t.textContent="Sending...";try{const i=await fetch("/send-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),r=await Y(i);if(i.ok&&r.success){d.otpSent=!0,l("Verification code sent to your email!","success"),O(2);const s=Number(r.expiresIn)||300,u=Number(r.resendAfter)||60;fe(s),ne(u)}else if(i.status===429){const s=Number(i.headers.get("Retry-After")),u=Number(r.retryAfter)||(isNaN(s)?60:s)*1e3,X=Math.ceil(u/1e3);l(`Too many requests. Please wait ${X}s before retrying.`,"warning"),O(2),ne(X)}else throw new Error(r.error||"Failed to send verification code")}catch(i){console.error("OTP send error:",i),l(i.message,"danger")}finally{T.disabled=!1,n.classList.add("d-none"),t.textContent="Send Verification Code"}}),w.addEventListener("click",async()=>{const e=d.currentEmail,t=y.value.trim();if(!t||t.length!==6){l("Please enter a 6-digit verification code.","warning"),y.focus();return}const n=w.querySelector(".btn-text"),i=w.querySelector(".spinner-border");w.disabled=!0,i.classList.remove("d-none"),n.textContent="Verifying...";try{const r=await fetch("/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otp:t})}),s=await Y(r);if(r.ok&&s.success)d.isVerified=!0,d.verificationToken=s.verificationToken,l("Email verified successfully!","success"),O(3),$(),setTimeout(()=>{D.hide()},2e3);else{let u=s.error||"Invalid verification code";if(typeof s.remainingAttempts=="number"&&(u+=` (${s.remainingAttempts} attempts left)`),s.code==="OTP_EXPIRED"){const X=document.getElementById("otp-countdown");X&&(X.textContent="Expired",X.className="fw-bold text-danger")}(s.code==="TOO_MANY_ATTEMPTS"||s.remainingAttempts===0)&&(w.disabled=!0),l(u,"danger"),y.classList.add("is-invalid"),document.getElementById("otp-error").textContent=u;return}}catch(r){console.error("OTP verification error:",r),l(r.message,"danger"),y.classList.add("is-invalid"),document.getElementById("otp-error").textContent=r.message}finally{w.disabled=!1,i.classList.add("d-none"),n.textContent="Verify Code"}}),U.addEventListener("click",()=>{d.resendTimer>0||(y.value="",y.classList.remove("is-invalid"),T.click())}),y.addEventListener("input",e=>{let t=e.target.value.replace(/\D/g,"");t.length>6&&(t=t.slice(0,6)),e.target.value=t,e.target.classList.remove("is-invalid"),document.getElementById("otp-error").textContent="",t.length===6&&setTimeout(()=>w.click(),500)});let R;function fe(e=300){let t=Number(e);(!Number.isFinite(t)||t<=0)&&(t=300);const n=document.getElementById("otp-countdown");clearInterval(R),R=setInterval(()=>{const i=Math.floor(t/60),r=t%60;n.textContent=`${i}:${r.toString().padStart(2,"0")}`,t<=0&&(clearInterval(R),n.textContent="Expired",n.className="fw-bold text-danger",l("Verification code expired. Please request a new one.","warning")),t--},1e3)}let F;function ne(e=60){d.resendTimer=Number(e)||60;const t=document.getElementById("resend-countdown"),n=document.getElementById("resend-timer");U.disabled=!0,t.classList.remove("d-none"),clearInterval(F),F=setInterval(()=>{n.textContent=d.resendTimer,d.resendTimer--,d.resendTimer<0&&(clearInterval(F),U.disabled=!1,t.classList.add("d-none"),d.resendTimer=0)},1e3)}const oe=document.getElementById("change-email-link");oe&&oe.addEventListener("click",()=>{D.hide(),setTimeout(()=>{g.scrollIntoView({behavior:"smooth",block:"center"}),g.focus()},300)}),y.addEventListener("paste",e=>{e.preventDefault();const n=(((e.clipboardData||window.clipboardData).getData("text")||"").match(/\d/g)||[]).join("").slice(0,6);n&&(y.value=n,y.dispatchEvent(new Event("input")))}),$(),window.location.hostname==="localhost"&&f.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("change",()=>{console.log("[FORM AUDIT]","Field changed",{id:Z(e.id),value:Z(e.value)})})})})}
